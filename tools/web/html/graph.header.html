	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
	
    <script type="text/javascript">

	var nd = new Date();
	var TimezoneOffset = nd.getTimezoneOffset() * 60000;
	var lastData = new Array();
	var maxDisplay = 40;
	var interval, play = false;
	
	function getValues() {
	var allData = $.ajax({
			url: "graph-data",
			//url: "data.js", //for testing
			dataType:"json",
			async: false
			}).responseText;
		var i, j, z;
		allData = allData.split("|");
		for(i = 0; i < allData.length; i++){
			if(allData[i].length > 0){
				allData[i] = allData[i].split(":");
				allData[i][1] = allData[i][1].split(";");
				for(z = 0; z < allData[i][1].length; z++){
					if(allData[i][1][z].length > 0){
						allData[i][1][z] = allData[i][1][z].split(",");
						allData[i][1][z][0] = Number(allData[i][1][z][0]) - TimezoneOffset;
						allData[i][1][z][1] = Number(allData[i][1][z][1]);
					}
					else{
						allData[i][1].splice(z,1);
						z--;
					}
				}				
			}
			else{
				allData.splice(i,1);
				i--;
			}
		}
		var dataList = new Array();
		for(i = 0; i < allData.length; i++){
			dataList[i] = {};
			dataList[i]["name"] = allData[i][0];
			dataList[i]["data"] = allData[i][1];
		}
		return dataList
	}
	function drawChart(time) {
		var dataList;
		dataList = getValues();
		if(dataList.length > 0){
			//Options in http://api.highcharts.com/
			$('#container').highcharts({
				title: {
					text: 'Measurements from all motes.'
				},
				/*subtitle: {
					text: 'Subtitle'
				},*/	
				xAxis: {
					type: 'datetime',
					dateTimeLabelFormats: {
						month: '%e. %b',
						year: '%b'
					}
				},
				yAxis: {
					title: {
						text: "measurements"
					}
				},
				plotOptions: {
					series: {
						animation: {
							duration: 2000
						}
					}
				},
				chart:{
					type: 'spline',
					animation: {
						duration: 900,   // As close to interval as possible.
						easing: 'linear'  // Important: this makes it smooth
					}
				},
				tooltip: {
					formatter: function() {
							return '<b>'+ this.series.name +'</b><br/>'+
							Highcharts.dateFormat('%e. %b', this.x) +': '+ this.y;
					}
				},
				series: dataList
			});
			for(i = 0; i < dataList.length; i++){
				lastData[i] = new Array();
				lastData[i][0] = dataList[i]["data"][dataList[i]["data"].length - 1][0];
				lastData[i][1] = dataList[i]["data"].length
			}
			setTimeout(StartGraph,900);
		}
		else{
			time += 2000;
			if (time > 10000) time = 10000;
			setTimeout(function (){drawChart(time)},time);
		}
    }
	function StartGraph(){
		interval = setInterval(updateChart, 1000);
		play = true;
	}
	function StopGraph(){
		clearInterval(interval);
		play = false;
	}
	function button(){
		if (!play) StartGraph();
		else StopGraph();
	}
	function updateChart(){
		var dataList, j, add;
		dataList = getValues();
		if(dataList.length > 0){
			for(i = 0; i < dataList.length; i++){
				if (lastData[i] != undefined){
					if (lastData[i][0] != dataList[i]["data"][dataList[i]["data"].length - 1][0]){
						j = dataList[i]["data"].length - 1;
						for(; j > 0 && lastData[i][0] != dataList[i]["data"][j][0]; j--);
						add = dataList[i]["data"].length - j
						lastData[i][1] += add - 1;
						add = lastData[i][1] - maxDisplay;
						if(add > 0) lastData[i][1] = maxDisplay;
						j++; //j stveja uz vienada
						for(; j < dataList[i]["data"].length; j++){
							$('#container').highcharts().series[i].addPoint(
								[
									dataList[i]["data"][j][0],
									dataList[i]["data"][j][1]
								],
								false,
								add > 0
							);
							add --;
							lastData[i][0] = dataList[i]["data"][dataList[i]["data"].length - 1][0];
						}
					}
				}
				else{
					window.location.reload();
				}
			}
			$('#container').highcharts().redraw();
		}
	}
	$(function (){
		drawChart(0);
	})
    </script>
